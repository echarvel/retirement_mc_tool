# Retirement Monte Carlo Tool â€” documented .env.example
#
# Units:
#   - All dollar amounts are REAL (inflation-adjusted) annual dollars unless noted.
#   - Returns are REAL (after inflation).
#
# Conventions:
#   - Ages are integer ages at each year boundary (simulation uses 1-year steps).
#   - Year 0 can be a partial year via PARTIAL_YEAR_FRACTION.

# -----------------------------
# Core simulation controls
# -----------------------------
SEED=424242                  # RNG seed (change to test sensitivity)
N_SIMS=25000                 # number of Monte Carlo paths

START_PORTFOLIO=1477000      # starting liquid portfolio (real $)
START_AGE=53                 # starting age at time 0
PARTIAL_YEAR_FRACTION=0.894444  # fraction of the first year remaining (e.g., retiring partway through the year)

OUTPUT_DIR=outputs           # output root directory; each run creates a timestamped subfolder

# -----------------------------
# Run modes
# -----------------------------
MODE=optimize                # optimize | single
E_FIXED=80000                # used only when MODE=single (fixed planned spending E)

# -----------------------------
# Return model (real)
# -----------------------------
RETURN_MU_REAL=0.04          # expected real return of the risky portfolio
RETURN_VOL_REAL=0.10         # volatility of real returns (normal model, clipped at -99%)

# -----------------------------
# Optimization controls (MODE=optimize)
# -----------------------------
# --- Optimization objective ---
# Which success probability the optimizer targets when searching for max E:
#   death_weighted : optimize on death-weighted success (default)
#   age_99         : optimize on success-to-age-99
#   both_min       : optimize on min(p_death_weighted, p_to_99)
#   both_weighted  : optimize on (w*p_death_weighted + (1-w)*p_to_99)
OPTIMIZE_SUCCESS_METRIC=death_weighted
BOTH_WEIGHT=0.5

TARGET_SUCCESS_DEATH_WEIGHTED=0.90  # target success probability (death-weighted)
E_LO=40000                   # lower bound for E search (real $/yr)
E_HI=220000                  # upper bound for E search (real $/yr)
E_SEARCH_ITERS=19            # iterations of binary search for max E

# -----------------------------
# Income: Social Security (real)
# -----------------------------
SS_ANNUAL_REAL=46405         # combined annual SS income (real $/yr)
SS_START_AGE=63              # age at which SS begins (model assumes SS starts fully at this age)

# -----------------------------
# Income: earned income after retirement (real)
# -----------------------------
EARNED_INCOME_ANNUAL_REAL=0  # set >0 to enable (real $/yr)
EARNED_INCOME_START_AGE=54   # first age income applies
EARNED_INCOME_END_AGE=62     # last age income applies (inclusive). Set < START to disable.

# -----------------------------
# How income is applied
# -----------------------------
INCOME_APPLIES_TO_ACTUAL_SPEND=1
# 1 (recommended):
#   - SS + earned income reduce the *actual* desired spending each year.
#   - If income exceeds desired spending, the surplus is contributed back into assets.
# 0 (legacy):
#   - income is applied earlier by reducing the planned withdrawal schedule; surplus handling is optional.

SURPLUS_ALLOCATION=reserve_first
# reserve_first: surplus fills reserve targets first, then goes to risky
# risky_first: surplus goes directly to risky

ALLOW_SURPLUS_SAVINGS=0
# legacy-only (used when INCOME_APPLIES_TO_ACTUAL_SPEND=0):
# if 1, invests income above planned E back into assets (older behavior)

# -----------------------------
# Spending floor (real)
# -----------------------------
FLOOR_ANNUAL_REAL=60000
# Minimum total annual spending (real $/yr) the strategy tries to maintain.
# With INCOME_APPLIES_TO_ACTUAL_SPEND=1, the *asset-funded* floor becomes:
#   max(0, FLOOR_ANNUAL_REAL - income_this_year)

# -----------------------------
# Cash / safe reserves
# -----------------------------
RESERVE_YEARS_LIST=0.5,1.0,1.5,2.0  # scenarios: reserve size in years of spending
RESERVE_CASH_FRACTION=0.5          # fraction of reserves held as cash (rest as base treasuries)
SAFE_REAL_RETURN=0.01              # real return for cash/base-treas bucket (ladder proxy)

# -----------------------------
# Guardrails (spending cuts when drawdowns occur)
# -----------------------------
DD1=0.15                    # drawdown threshold 1 (e.g., -15% from peak)
DD2=0.25                    # drawdown threshold 2 (e.g., -25% from peak)
CUT1=0.50                   # fraction of "flex" spending cut at DD1
CUT2=1.00                   # fraction of "flex" spending cut at DD2 (1.0 means cut all flex)

# "Flex" is a model abstraction: spending = base + flex, where flex can be cut in bad years.
# These baseline values calibrate how much of E is treated as flexible pre/post SS.
BASELINE_E_FOR_FLEX=99300.0         # reference E used to interpret flex knobs
BASELINE_FLEX_PRE=20000.0           # flex spending amount pre-SS at baseline
BASELINE_NET_POST_SS=52895.0        # typical net withdrawal post-SS at baseline (for calibration)
BASELINE_FLEX_POST=10000.0          # flex spending amount post-SS at baseline

# -----------------------------
# Reverse mortgage LOC (simplified model)
# -----------------------------
RM_OPEN_AGE=62               # age you open the reverse mortgage LOC
HOME_VALUE_REAL=950000       # home value in real dollars at open (model uses real growth below)
RM_PLF_AT_OPEN=0.40          # principal limit factor at open (rough proxy)
RM_LIMIT_REAL_GROWTH=0.015   # annual real growth of available credit line
RM_BAL_REAL_RATE=0.015       # real interest rate on outstanding RM balance
RM_PARTIAL_COVER=0.50        # fraction of spending shortfall that RM is allowed to cover (0..1)
RM_REPAY_RATE=0.15           # repayment aggressiveness in good years (heuristic)
PAYOFF_DD_THRESHOLD=0.05     # only repay RM/loan when drawdown is better than this threshold

# -----------------------------
# Conventional loan (fixed-rate, simplified)
# -----------------------------
LOAN_AMOUNTS=0,100000,150000,200000  # scenarios: initial loan principal (real $)
LOAN_REAL_RATE=0.03          # real interest rate proxy (approx; in reality loans are nominal)
LOAN_TERM_YEARS=30           # amortization term in years

# Loan bucket: where the borrowed funds sit (safe bucket proxy)
LOAN_BUCKET_REAL_RETURN=0.01 # real return on the loan-funded bucket
LOAN_BUCKET_USE_DD=0.15      # if drawdown worse than this, allow using the bucket to cover spending
LOAN_BUCKET_PARTIAL_COVER=0.50  # fraction of shortfall the bucket can cover (0..1)
